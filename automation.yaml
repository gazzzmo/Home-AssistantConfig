# Automations
- alias: "Tweet Download Speed"
  trigger:
    platform: numeric_state
    entity_id: sensor.speedtest_download
    below: '5'
  action:
    service: notify.twitter
    data:
      message: "My download speed on @foxtel ADSL is currently {{ states('sensor.speedtest_download') }} Mbit/s No @nbn_australia in Sunnybank QLD 4109 #NBNFail"

- alias: "Notify Location"
  trigger:
    platform: state
    entity_id: group.family
  action:
    service: notify.telstrasms
    data:
      message: >
        {% for device in dict(states.device_tracker|groupby('state'))['home'] %}{% if loop.last and loop.length > 1 %} and {% elif not loop.first and loop.length > 1 %}, {% endif %}{{ device.name }}{% endfor %} {% if dict(states.device_tracker|groupby('state'))['home']|length == 1 %}is{% else %}are{% endif %} at home.
        {% for device in dict(states.device_tracker|groupby('state'))['not_home'] %}{% if loop.last and loop.length > 1 %} and {% elif not loop.first and loop.length > 1 %}, {% endif %}{{ device.name }}{% endfor %} {% if dict(states.device_tracker|groupby('state'))['not_home']|length == 1 %}is{% else %}are{% endif %} away.

- alias: "Notify Jess Leaves School"
  trigger:
    platform: zone
    entity_id: device_tracker.jesssiphone
    zone: zone.school
    event: leave
  action:
    service: notify.telstrasms
    data:
      message: "Jess just left school"

- alias: "Lights On At Sunset"
  trigger:
    platform: sun
    event: sunset
    offset: '-00:15:00'
  action:
    service: scene.turn_on
    entity_id: scene.cozy_warm_evenings
    
- alias: "Switch Xmas Lights On At Sunset"     
  trigger:
    platform: sun
    event: sunset
    offset: '-00:15:00'
  action:
    - service: switch.turn_on
      entity_id: switch.christmas_lights_frontyard
    - service: switch.turn_on
      entity_id: switch.christmas_lights_backyard   
      
- alias: "Switch Xmas Lights Off At Midnight"     
  trigger:
    platform: time
    after: '00:00:00'
  action:
    - service: switch.turn_off
      entity_id: switch.christmas_lights_frontyard
    - service: switch.turn_off
      entity_id: switch.christmas_lights_backyard

- alias: "Notify My Phone Battery Level"
  trigger:
    platform: numeric_state
    entity_id: sensor.gareth_iphone_battery_level
    below: 30
  condition:
    condition: state
    entity_id: sensor.gareth_iphone_battery_state
    state: Unplugged
  action:
    service: notify.telstrasms
    data:
      message: Hey Gareth. Your phone battery is getting low. It's currently {{ states("sensor.gareth_iphone_battery_level") }}%. Time to charge up!

- alias: 'Update Available Notifications'
  trigger:
    platform: state
    entity_id: updater.updater
  action:
    - service: notify.telstrasms
      data:
        message: 'Update for Home Assistant is available.'
    - service: notify.notify
      data:
        message: 'Update for Home Assistant is available.'